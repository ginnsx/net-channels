# net-channels

物理隔离的网络环境下，利用二维码进行数据传输。

## 功能描述

### 核心功能

- 内外网物理隔离环境下的数据传输
- 通过二维码作为数据传输媒介
- 大数据量需要分片传输
- 确保数据传输的可靠性和完整性

### 关键需求

1. 数据传输

    - [x] 支持分片传输
    - [x] 保证数据完整性和准确性
    - [x] 优化传输速度
    - [x] 针对 Header 进行优化，压缩包头体积

2. 安全性

    - [x] 数据加密
    - [x] 传输验证
    - [x] 防篡改机制

3. 用户体验

    - [x] 传输进度显示
    - [x] 错误提示和重试机制

## 系统架构

```plaintext
[外网区域]                    [内网区域]
+---------------+            +---------------+
| 外网服务器     |            | 内网服务器     |
| - 数据处理     |   二维码    | - 数据处理     |
| - 分片管理     | ---------> | - 分片重组     |
| - 编码生成     |   扫描      | - 数据校验     |
+---------------+            +---------------+
       ↑                            ↓
+---------------+            +---------------+
| 外网客户端     |            | 内网客户端     |
| - 展示二维码   |            | - 扫码器对接   |
+---------------+            +---------------+
```

### 核心模块设计

1. **通用核心模块 (net-channels-core)**

   ```plaintext
   com.netchannels.core
   ├── model/          # 数据模型
   ├── protocol/       # 传输协议
   ├── crypto/         # 加密工具
   ├── compress/       # 压缩工具
   ├── session/        # 会话管理，用于分片传递和重传
   └── exception/      # 异常处理
   └── cache/          # 缓存，用于分片缓存
   └── transfer/       # 数据拆分/重组
   ```

2. **外网服务端 (net-channels-external)**

   ```plaintext
   com.netchannels.external
   ├── controller/     # 接口控制器
   ├── service/        # 业务服务
   └── config/         # 配置管理
   ```

3. **内网服务端 (net-channels-internal)**

   ```plaintext
   com.netchannels.internal
   ├── controller/     # 接口控制器
   ├── service/        # 业务服务
   └── config/         # 配置管理
   ```

### 数据传输协议

Packet 包结构


```plaintext
{
    "header": {
        "sessionId": "123456789", // 会话ID 9 bytes
        "totalChunks": 100, // 总分片数
        "currentChunk": 1, // 当前分片序号
        "chunkSize": 2048, // 分片大小
        "totalSize": 204800, // 总数据大小
        "checksum": "crc32C-hash" // 数据校验和 8 bytes
    },
    "data": "base64-encoded-data" // 加密后的数据
}
```

**实际传输时会序列化成二进制数据，再进行 Base64 编码。尽管 Base64 编码会增加大约 33% 的数据量，但使用 gzip 压缩后，整体效果还是不错的。对于 Json 数据，能保证有效载荷比率（原始数据大小 / 传输数据大小）在 300% 以上。**

### 传输流程

发送端流程

1. 接收数据并创建传输会话
2. 数据分片处理
3. 对每个分片进行加密和校验
4. 生成二维码并按序展示
5. 跟踪传输进度

接收端流程

1. 扫描二维码获取数据
2. 解析协议头部信息
3. 验证数据完整性
4. 临时存储分片数据
5. 所有分片接收完成后重组数据

## 性能指标

- 有效数据荷载（原始数据大小 / 传输数据大小）: JSON 数据 >= 300%，随机数据 >= 110%
- 发送处理时间(ms): 10 个包 < 50ms
- 数据处理时间 (ms): 10 个包 < 30ms
- 有效数据比率: >= 96%，将 Header 的影响降到最低
